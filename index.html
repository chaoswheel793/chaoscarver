<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#8B4513"/>
  <title>Chaos Carver â€” Carve Anything</title>
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\": \"Chaos Carver\",
    \"short_name\": \"Carver\",
    \"start_url\": \".\",
    \"display\": \"standalone\",
    \"background_color\": \"#000\",
    \"theme_color\": \"#8B4513\",
    \"icons\": [{
      \"src\": \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M20 10 L80 10 L90 30 L90 70 L80 90 L20 90 L10 70 L10 30 Z' fill='%238B4513'/%3E%3Cpath d='M50 40 L60 50 L55 60 Z' fill='%23D4A574'/%3E%3C/svg%3E\",
      \"sizes\": \"192x192\",
      \"type\": \"image/svg+xml\"
    }]
  }"/>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#000; color:#fff; font-family:'Courier New',monospace; overflow:hidden; touch-action:none; }
    #scene { perspective:1200px; width:100vw; height:100vh; display:flex; justify-content:center; align-items:center; }
    #container { transform-style:preserve-3d; width:240px; height:240px; position:relative; }
    .face { position:absolute; width:240px; height:240px; background:#D4A574; border:4px solid #8B5A2B; box-shadow:inset 0 0 30px rgba(0,0,0,0.4); }
    .face.front  { transform:translateZ(120px); }
    .face.back   { transform:rotateY(180deg) translateZ(120px); }
    .face.right  { transform:rotateY(90deg) translateZ(120px); }
    .face.left   { transform:rotateY(-90deg) translateZ(120px); }
    .face.top    { transform:rotateX(90deg) translateZ(120px); }
    .face.bottom { transform:rotateX(-90deg) translateZ(120px); }

    /* OUTLINES */
    .outline { position:absolute; border:4px dashed #00f; pointer-events:none; }
    .front .outline  { width:160px; height:140px; top:50px; left:40px; clip-path:polygon(30% 0%, 70% 0%, 85% 30%, 75% 60%, 60% 100%, 40% 100%, 25% 60%, 15% 30%); }
    .top .outline    { width:160px; height:160px; top:40px; left:40px; clip-path:ellipse(50% 40% at 50% 50%); }
    .side .outline   { width:140px; height:180px; top:30px; left:50px; clip-path:polygon(40% 0%, 60% 0%, 80% 40%, 70% 80%, 50% 100%, 30% 80%, 20% 40%); }

    /* HIDDEN DUCK */
    #duck { position:absolute; width:140px; height:140px; top:50px; left:50px; background:#FFD700; border-radius:50% 50% 40% 40%; transform:translateZ(1px); pointer-events:none; opacity:0; transition:opacity 0.5s; }
    #duck.visible { opacity:1; }

    /* TOOLS */
    #tools { position:absolute; bottom:10%; left:50%; transform:translateX(-50%); pointer-events:none; z-index:10; }
    .hand { width:70px; height:120px; background:#F4C2A1; border-radius:40px 40px 15px 15px; position:absolute; bottom:0; }
    .hand.left { left:-60px; transform:rotate(-25deg); }
    .hand.right { left:10px; transform:rotate(25deg); }
    .chisel { width:10px; height:100px; background:linear-gradient(#ddd, #aaa); position:absolute; bottom:100px; left:50%; transform:translateX(-50%) rotate(50deg); border-radius:6px 6px 0 0; box-shadow:0 0 15px rgba(0,0,0,0.6); }
    .chisel::after { content:''; width:25px; height:25px; background:#666; position:absolute; bottom:-12px; left:-8px; border-radius:50%; }

    /* PARTICLES */
    .chip { position:absolute; width:8px; height:8px; background:#D4A574; border-radius:50%; pointer-events:none; animation:fall 1.2s linear forwards; }
    @keyframes fall { to { transform:translateY(400px) rotate(1080deg); opacity:0; } }

    /* UI */
    h1 { position:absolute; top:5%; left:50%; transform:translateX(-50%); font-size:36px; text-shadow:0 0 20px #ff0044; }
    .score { position:absolute; top:15%; left:50%; transform:translateX(-50%); font-size:20px; color:#39ff14; }
    .tools-ui { position:absolute; bottom:15%; left:50%; transform:translateX(-50%); display:flex; gap:10px; }
    .tool-btn { background:#333; color:white; border:2px solid #ff0044; padding:8px 16px; border-radius:30px; cursor:pointer; font-size:14px; }
    .tool-btn.active { background:#ff0044; }
    #export { position:absolute; bottom:8%; left:50%; transform:translateX(-50%); background:#ffd700; color:#000; padding:8px 20px; border:none; border-radius:30px; cursor:pointer; font-size:14px; }
    #level { position:absolute; top:20%; left:50%; transform:translateX(-50%); font-size:16px; color:#aaa; }
  </style>
</head>
<body>
  <div id="scene">
    <div id="container">
      <div class="face front"><div class="outline"></div></div>
      <div class="face back"><div class="outline side"></div></div>
      <div class="face right"><div class="outline side"></div></div>
      <div class="face left"><div class="outline side"></div></div>
      <div class="face top"><div class="outline"></div></div>
      <div class="face bottom"><div class="outline"></div></div>
      <div id="duck"></div>
    </div>
    <div id="tools">
      <div class="hand left"></div>
      <div class="hand right"></div>
      <div class="chisel"></div>
    </div>
  </div>
  <h1>CHAOS CARVER</h1>
  <div class="score">Score: <span id="score">0</span>%</div>
  <div id="level">Level 1 / 10</div>
  <div class="tools-ui">
    <button class="tool-btn active" data-tool="gouge">Gouge</button>
    <button class="tool-btn" data-tool="vtool">V-Tool</button>
    <button class="tool-btn" data-tool="mallet">Mallet</button>
  </div>
  <button id="export">Export .OBJ</button>

  <script>
    const container = document.getElementById('container');
    const chisel = document.querySelector('.chisel');
    const tools = document.getElementById('tools');
    const duck = document.getElementById('duck');
    const scoreEl = document.getElementById('score');
    let isRotating = false, isCarving = false;
    let rotX = -25, rotY = 30;
    let score = 0;
    let tool = 'gouge';

    // TOOL SWITCH
    document.querySelectorAll('.tool-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        tool = btn.dataset.tool;
      });
    });

    // ROTATE
    let startX, startY;
    document.addEventListener('pointerdown', e => {
      isRotating = true;
      startX = e.clientX; startY = e.clientY;
    });
    document.addEventListener('pointermove', e => {
      if (!isRotating) return;
      rotY += (e.clientX - startX) * 0.6;
      rotX -= (e.clientY - startY) * 0.6;
      container.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
      startX = e.clientX; startY = e.clientY;
    });
    document.addEventListener('pointerup', () => isRotating = false);

    // CARVE
    document.addEventListener('pointerdown', e => {
      if (e.target.closest('button')) return;
      isCarving = true;
      tools.style.opacity = '1';
      chisel.style.transform = `translateX(-50%) rotate(${tool === 'mallet' ? 70 : 65}deg) scale(1.15)`;
      createChip(e.clientX, e.clientY);
      playSound();
      vibrate();
      updateScore();
    });
    document.addEventListener('pointerup', () => {
      isCarving = false;
      tools.style.opacity = '0.7';
      chisel.style.transform = `translateX(-50%) rotate(${tool === 'mallet' ? 55 : 50}deg) scale(1)`;
    });

    function createChip(x, y) {
      const chip = document.createElement('div');
      chip.className = 'chip';
      chip.style.left = x + 'px';
      chip.style.top = y + 'px';
      document.body.appendChild(chip);
      setTimeout(() => chip.remove(), 1200);
    }

    function playSound() {
      const sounds = { gouge: 'chip.mp3', vtool: 'scrape.mp3', mallet: 'thud.mp3' };
      const audio = new Audio(sounds[tool] || 'chip.mp3');
      audio.volume = 0.3;
      audio.play().catch(() => {});
    }

    function vibrate() {
      if (navigator.vibrate) navigator.vibrate([30, 20, 30]);
    }

    function updateScore() {
      score = Math.min(100, score + (tool === 'mallet' ? 3 : 1));
      scoreEl.textContent = score;
      if (score > 80) duck.classList.add('visible');
    }

    // EXPORT .OBJ
    document.getElementById('export').addEventListener('click', () => {
      const obj = `# Chaos Carver Export\nv 0 0 0\nv 1 0 0\nf 1 2`;
      const blob = new Blob([obj], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'carved_duck.obj'; a.click();
    });

    // INITIAL
    container.style.transform = `rotateX(-25deg) rotateY(30deg)`;
    tools.style.opacity = '0.7';
  </script>
</body>
</html>
